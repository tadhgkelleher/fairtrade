<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
  <style>
    #connections-graph-container {
      position: relative;
      background-color: #003300;  /* Deep forest green */
      margin: 0 auto;
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #connections-graph {
      height: 700px;
      width: 100%;
      border: 2px solid #ffd700;  /* Gold border */
      border-radius: 8px;
      overflow: hidden;
    }

    .toggle-physics-button {
      background-color: #2e8b57;  /* Forest green */
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      font-size: 18px;
      margin: 0 auto;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 10px;
      z-index: 9999;
      transition: background-color 0.3s ease;
    }

    .toggle-physics-button:hover {
      background-color: #228b22;
    }

    .toggle-physics-button:active {
      transform: translateY(1px);
    }

    h1 {
      color: #ffd700;
      text-align: center;
      margin-bottom: 20px;
      font-size: 28px;
    }

    .sponsorship-heading {
      color: #ffd700;
      text-align: center;
      margin-top: 40px;
      font-size: 36px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="sponsorship-heading">Fair Trade Coffee Network</div>

<div id="connections-graph-container">
  <button class="toggle-physics-button">Toggle Physics</button>
  <div id="connections-graph"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = [
      { id: 1, title: "Café Brazil", type: "Farm", tags: ["Coffee Beans", "Brazil", "Organic", "Fair Trade"] },
      { id: 2, title: "Finca la Verde", type: "Farm", tags: ["Coffee Beans", "Colombia", "Organic", "Fair Trade"] },
      { id: 3, title: "Café el Salvador", type: "Farm", tags: ["Coffee Beans", "El Salvador", "Organic", "Fair Trade"] },
      { id: 4, title: "Green Beans Inc.", type: "Supplier", tags: ["Brazil", "Organic", "Fair Trade", "Supplier"] },
      { id: 5, title: "True Coffee Co.", type: "Supplier", tags: ["Colombia", "Organic", "Fair Trade", "Supplier"] },
      { id: 6, title: "Fresh Brew Distributors", type: "Distributor", tags: ["Distributors", "Brazil", "Colombia", "Fair Trade"] },
      { id: 7, title: "Eco Coffee Shop", type: "Shop", tags: ["Shop", "Organic", "Fair Trade", "Local Coffee"] },
      { id: 8, title: "Green Bean Café", type: "Shop", tags: ["Shop", "Organic", "Fair Trade", "Local Coffee"] },
      { id: 9, title: "Earth Roast Café", type: "Shop", tags: ["Shop", "Fair Trade", "Organic", "Specialty Coffee"] },
      { id: 10, title: "Cafe Verde", type: "Shop", tags: ["Shop", "Fair Trade", "Brazil", "Organic"] },
      { id: 11, title: "Café Verde Distribution", type: "Distributor", tags: ["Distributor", "Brazil", "Fair Trade"] },
      { id: 12, title: "Roast Farms", type: "Plant", tags: ["Plant", "Brazil", "Roasting", "Fair Trade"] },
      { id: 13, title: "Café Roasters", type: "Plant", tags: ["Plant", "Colombia", "Roasting", "Fair Trade"] },
      { id: 14, title: "Cafe Trade Network", type: "Profit", tags: ["Profit", "Fair Trade", "Global Coffee"] },
      { id: 15, title: "Eco Trade Cooperative", type: "Profit", tags: ["Profit", "Sustainable", "Fair Trade"] },
      { id: 16, title: "Tropical Brews", type: "Supplier", tags: ["Supplier", "Fair Trade", "Brazil"] },
      { id: 17, title: "Coffee to the People", type: "Supplier", tags: ["Supplier", "Colombia", "Fair Trade"] },
      { id: 18, title: "Café Bio", type: "Farm", tags: ["Farm", "Brazil", "Fair Trade", "Eco"] },
      { id: 19, title: "Coffee Connect", type: "Distributor", tags: ["Distributor", "Fair Trade", "Organic"] },
      { id: 20, title: "Brew Masters", type: "Shop", tags: ["Shop", "Brazil", "Coffee", "Organic"] }
    ];

    const nodes = new vis.DataSet([]);
    const edges = new vis.DataSet([]);
    const nodeConnections = {};

    const groups = {
      farm: {
        color: { background: '#228b22', border: '#006400' },  // Green for farms
      },
      supplier: {
        color: { background: '#8b4513', border: '#4b2c1b' },  // Brown for suppliers
      },
      distributor: {
        color: { background: '#228b22', border: '#006400' },  // Green for distributors
      },
      shop: {
        color: { background: '#ff7f50', border: '#ff4500' },  // Coral for coffee shops
      },
      plant: {
        color: { background: '#2e8b57', border: '#3cb371' },  // Forest green for plants
      },
      profit: {
        color: { background: '#ffd700', border: '#c41e3a' },  // Gold for profit
      }
    };

    // Create a set to ensure unique nodes
    const addedItems = new Set();

    items.forEach(item => {
      // Add the node (item) only if it hasn't been added already
      if (!addedItems.has(item.title)) {
        nodes.add({
          id: item.title,
          label: item.title,
          title: `<h3>${item.title}</h3><ul>${item.tags.map(tag => `<li>${tag}</li>`).join('')}</ul>`,
          group: item.type.toLowerCase(),
          font: { color: '#ffffff', size: 16 }
        });
        addedItems.add(item.title);
      }

      item.tags.forEach(tag => {
        // Create an edge between the item and tag
        edges.add({
          from: item.title,
          to: tag,
          color: { color: '#ffffff', highlight: '#ffd700' }
        });

        // Track connections for size calculation
        nodeConnections[tag] = (nodeConnections[tag] || 0) + 1;
        nodeConnections[item.title] = (nodeConnections[item.title] || 0) + 1;
      });
    });

    // Adjust the size of each node based on total connections
    nodes.forEach(node => {
      const connectionCount = nodeConnections[node.id] || 0;
      node.size = Math.max(10, connectionCount * 3);  // Ensure node size is proportional to connections
      nodes.update(node);
    });

    const container = document.getElementById("connections-graph");
    const data = { nodes: nodes, edges: edges };

    const options = {
      nodes: {
        shape: 'dot',
        scaling: {
          min: 10,
          max: 50
        }
      },
      edges: {
        width: 2,
        smooth: {
          type: 'continuous'
        }
      },
      physics: {
        enabled: false
      },
      interaction: {
        hover: true,
        zoomView: true,
        dragView: true,
        dragNodes: true,
        zoomSpeed: 0.5,
        tooltipDelay: 200
      },
      groups: groups,
      layout: {
        randomSeed: 2,
        improvedLayout: true
      }
    };

    const network = new vis.Network(container, data, options);

    function applyCircularLayout() {
      const positions = {};
      const nodeCount = nodes.length;
      const radius = 300;
      const angle = (2 * Math.PI) / nodeCount;

      let i = 0;
      nodes.forEach((node) => {
        positions[node.id] = {
          x: radius * Math.cos(angle * i),
          y: radius * Math.sin(angle * i)
        };
        i++;
      });

      network.setOptions({ physics: { enabled: false } });
      network.moveTo({ scale: 0.3 });
      network.body.data.nodes.update(
        nodes.map(node => ({
          id: node.id,
          x: positions[node.id].x,
          y: positions[node.id].y
        }))
      );
    }

    network.moveTo({
      position: { x: 0, y: 0 },
      scale: 0.3,
      animation: {
        duration: 1000,
        easingFunction: 'easeInOutQuad'
      }
    });

    applyCircularLayout();

    const toggleButton = document.querySelector(".toggle-physics-button");
    let isPhysicsEnabled = false;

    toggleButton.addEventListener("click", function() {
      isPhysicsEnabled = !isPhysicsEnabled;
      network.setOptions({ physics: { enabled: isPhysicsEnabled } });
    });
  });
</script>

</body>
</html>
